#+TITLE: Union Find Data Structure in C# 

* Union Find Data Structure 

#+BEGIN_SRC csharp :tangle src/unionfind.cs
using System.Collections.Generic;

public class UnionFind<T> {

  public class SetElement {
    public SetElement parent;
    public readonly T value;
    public int size; 

    public SetElement(T value) {
      this.value = value;
      parent = this; 
      size = 1; 
    }

    override public string ToString() {
     return string.Format("{0}, size:{1}", value, size);
    }
  }

  Dictionary<T, SetElement> dict;

  public UnionFind() {
    dict = new Dictionary<T, SetElement>(); 
  }

  public SetElement MakeSet(T value) {
    SetElement element = new SetElement(value); 
    dict[value] = element;
    return element;
  }

  public SetElement Find(T value) {
    SetElement element = dict[value];
    SetElement root = element; 
    while(root.parent != root) {
      root = root.parent; 
    }
    SetElement z = element; 
    while(z.parent != z) {
      SetElement temp = z; 
      z = z.parent;
      temp.parent = root;
    }
    return root; 
  }

  public SetElement Union(SetElement root1, SetElement root2) {
    if (root2.size > root1.size) {
      root2.size += root1.size;
      root1.parent = root2;
      return root2;
    } else {
      root1.size += root2.size;
      root2.parent = root1;
      return root1;
    }
  }
}
#+END_SRC

* Applications

** Connected Components

#+BEGIN_SRC csharp :tangle demo/connectedcomponents.cs
using System; 
using Pair = System.Collections.Generic.KeyValuePair<string, string>;

public class ConnectedComponents {

  public static void Main() {

    string[] names = {"John", "George", "Paul", "Mick", "Ringo", "Bill", "Brian", "Charlie", "Keith" };
    Pair[] pairs = { new Pair("John", "George"), new Pair("Paul", "Ringo"), new Pair("Ringo", "George"), new Pair("Charlie", "Bill"), new Pair("Keith", "Mick"), new Pair("Brian", "Bill"), new Pair("Charlie", "Keith")}; 
    var UF = new UnionFind<string>(); 

    foreach(var name in names) 
      UF.MakeSet(name);

    foreach(var pair in pairs) {
      if (UF.Find(pair.Key) != UF.Find(pair.Value))
        UF.Union(UF.Find(pair.Key), UF.Find(pair.Value));
    }

    foreach(var name in names) 
      Console.WriteLine("{0} belongs to set {1}", name, UF.Find(name)); 
  }
}
#+END_SRC

#+BEGIN_SRC sh :exports both :results verbatim
mcs demo/connectedcomponents.cs src/unionfind.cs
mono demo/connectedcomponents.exe
#+END_SRC

#+RESULTS:
: John belongs to set Paul, size:4
: George belongs to set Paul, size:4
: Paul belongs to set Paul, size:4
: Mick belongs to set Charlie, size:5
: Ringo belongs to set Paul, size:4
: Bill belongs to set Charlie, size:5
: Brian belongs to set Charlie, size:5
: Charlie belongs to set Charlie, size:5
: Keith belongs to set Charlie, size:5

** Maze Generation


#+BEGIN_SRC csharp :tangle demo/mazegenerator.cs
using System; 
using System.Linq; 
using System.Collections.Generic; 

using Cell = System.Collections.Generic.KeyValuePair<int, int>;
using Edge = System.Collections.Generic.KeyValuePair<System.Collections.Generic.KeyValuePair<int, int>, System.Collections.Generic.KeyValuePair<int, int>>;

public class MazeGenerator {

  public static void DrawMaze(List<Edge> edges, int width, int height) {
    Console.WriteLine("\\begin{tikzpicture}[>=latex]");
    Console.WriteLine("  \\draw[thick](0,0) -- ({0},0);",width); 
    Console.WriteLine("  \\draw[thick](0,{0}) -- ({1},{0});",width, height); 
    Console.WriteLine("  \\draw[thick](0,0) -- (0,{0});",height-1);     
    Console.WriteLine("  \\draw[thick]({0},1) -- ({0},{1});",width, height); 
    foreach(var edge in edges) {
      var cell1 = edge.Key;
      var cell2 = edge.Value;
      if (cell1.Value == cell2.Value)
        Console.WriteLine("  \\draw({0},{1}) -- ({2},{3});", cell2.Key, cell1.Value, cell2.Key, cell1.Value+1);
      else 
        Console.WriteLine("  \\draw({0},{1}) -- ({2},{3});", cell1.Key, cell2.Value, cell1.Key+1, cell2.Value);
    }
    Console.WriteLine("\\end{tikzpicture}");
  }

  public static void Main(string[] args) {
  
    int width, height;
    if (!Int32.TryParse(args[0], out width)) width = 7;
    if (!Int32.TryParse(args[0], out height)) height = 7;

    var UF = new UnionFind<Cell>(); 
    var grid = Enumerable.Range(0, width*height).Select( x => new Cell(x%width,x/width));
    foreach (var cell in grid) // works! 
      UF.MakeSet(cell);
 
   var edges = new List<Edge>();
    foreach(var cell in grid) {
      if (cell.Key < width-1) edges.Add(new Edge(cell, new Cell(cell.Key+1, cell.Value)));
      if (cell.Value < height-1) edges.Add(new Edge(cell, new Cell(cell.Key, cell.Value+1)));
    }

    var random = new Random();
    int removedEdges = 0; 
    while (removedEdges < grid.Count()-1) {
      int next = random.Next(edges.Count);
      var edge = edges[next];
      if (UF.Find(edge.Key) != UF.Find(edge.Value)) {
        UF.Union(UF.Find(edge.Key),UF.Find(edge.Value));
	edges.RemoveAt(next);
	removedEdges++;
      }
    }
    DrawMaze(edges, width, height); 
  }
}
#+END_SRC

*** Example 

 #+BEGIN_SRC sh :results verbatim :wrap "SRC latex :imagemagick yes :iminoptions -density 600 :imoutoptions -geometry 400 :results raw :yexports results :fit yes :noweb yes :file images/maze.png  :headers '(\"\\\\usepackage{tikz}\")" :exports both
 mcs demo/mazegenerator.cs src/unionfind.cs
 mono demo/mazegenerator.exe 7 7 
 #+END_SRC

 #+RESULTS:
 #+BEGIN_SRC latex :imagemagick yes :iminoptions -density 600 :imoutoptions -geometry 400 :results raw :yexports results :fit yes :noweb yes :file images/maze.png  :headers '("\\usepackage{tikz}")
 \begin{tikzpicture}[>=latex]
   \draw[thick](0,0) -- (7,0);
   \draw[thick](0,7) -- (7,7);
   \draw[thick](0,0) -- (0,6);
   \draw[thick](7,1) -- (7,7);
   \draw(2,0) -- (2,1);
   \draw(1,1) -- (2,1);
   \draw(4,0) -- (4,1);
   \draw(3,1) -- (4,1);
   \draw(6,0) -- (6,1);
   \draw(5,1) -- (6,1);
   \draw(1,1) -- (1,2);
   \draw(3,2) -- (4,2);
   \draw(4,2) -- (5,2);
   \draw(6,2) -- (7,2);
   \draw(2,2) -- (2,3);
   \draw(1,3) -- (2,3);
   \draw(3,2) -- (3,3);
   \draw(2,3) -- (3,3);
   \draw(3,3) -- (4,3);
   \draw(5,3) -- (6,3);
   \draw(1,3) -- (1,4);
   \draw(0,4) -- (1,4);
   \draw(1,4) -- (2,4);
   \draw(3,4) -- (4,4);
   \draw(4,4) -- (5,4);
   \draw(6,3) -- (6,4);
   \draw(5,4) -- (6,4);
   \draw(1,5) -- (2,5);
   \draw(3,4) -- (3,5);
   \draw(2,5) -- (3,5);
   \draw(5,4) -- (5,5);
   \draw(4,5) -- (5,5);
   \draw(6,5) -- (7,5);
   \draw(1,5) -- (1,6);
   \draw(1,6) -- (2,6);
   \draw(3,5) -- (3,6);
   \draw(3,6) -- (4,6);
   \draw(5,6) -- (6,6);
   \draw(6,6) -- (7,6);
   \draw(2,6) -- (2,7);
 \end{tikzpicture}
 #+END_SRC

 #+RESULTS:
 [[file:images/maze.png]]


*** Larger Example 

 #+BEGIN_SRC sh :results verbatim :wrap "SRC latex :imagemagick yes :iminoptions -density 600 :imoutoptions -geometry 400 :results raw :yexports results :fit yes :noweb yes :file images/maze2.png  :headers '(\"\\\\usepackage{tikz}\")" :exports both
 mcs demo/mazegenerator.cs src/unionfind.cs
 mono demo/mazegenerator.exe 21 21 
 #+END_SRC

 #+RESULTS:
 #+BEGIN_SRC latex :imagemagick yes :iminoptions -density 600 :imoutoptions -geometry 400 :results raw :yexports results :fit yes :noweb yes :file images/maze2.png  :headers '("\\usepackage{tikz}")
 \begin{tikzpicture}[>=latex]
   \draw[thick](0,0) -- (21,0);
   \draw[thick](0,21) -- (21,21);
   \draw[thick](0,0) -- (0,20);
   \draw[thick](21,1) -- (21,21);
   \draw(3,0) -- (3,1);
   \draw(2,1) -- (3,1);
   \draw(6,0) -- (6,1);
   \draw(7,0) -- (7,1);
   \draw(8,0) -- (8,1);
   \draw(10,0) -- (10,1);
   \draw(9,1) -- (10,1);
   \draw(10,1) -- (11,1);
   \draw(11,1) -- (12,1);
   \draw(12,1) -- (13,1);
   \draw(13,1) -- (14,1);
   \draw(14,1) -- (15,1);
   \draw(16,0) -- (16,1);
   \draw(17,0) -- (17,1);
   \draw(18,0) -- (18,1);
   \draw(20,0) -- (20,1);
   \draw(19,1) -- (20,1);
   \draw(1,1) -- (1,2);
   \draw(0,2) -- (1,2);
   \draw(1,2) -- (2,2);
   \draw(2,2) -- (3,2);
   \draw(4,1) -- (4,2);
   \draw(5,1) -- (5,2);
   \draw(4,2) -- (5,2);
   \draw(6,1) -- (6,2);
   \draw(5,2) -- (6,2);
   \draw(9,1) -- (9,2);
   \draw(8,2) -- (9,2);
   \draw(10,1) -- (10,2);
   \draw(10,2) -- (11,2);
   \draw(14,1) -- (14,2);
   \draw(13,2) -- (14,2);
   \draw(15,2) -- (16,2);
   \draw(17,1) -- (17,2);
   \draw(19,1) -- (19,2);
   \draw(19,2) -- (20,2);
   \draw(0,3) -- (1,3);
   \draw(7,2) -- (7,3);
   \draw(6,3) -- (7,3);
   \draw(8,2) -- (8,3);
   \draw(7,3) -- (8,3);
   \draw(11,2) -- (11,3);
   \draw(12,2) -- (12,3);
   \draw(13,2) -- (13,3);
   \draw(12,3) -- (13,3);
   \draw(13,3) -- (14,3);
   \draw(14,3) -- (15,3);
   \draw(16,2) -- (16,3);
   \draw(16,3) -- (17,3);
   \draw(18,2) -- (18,3);
   \draw(17,3) -- (18,3);
   \draw(19,2) -- (19,3);
   \draw(20,3) -- (21,3);
   \draw(1,3) -- (1,4);
   \draw(2,3) -- (2,4);
   \draw(1,4) -- (2,4);
   \draw(3,3) -- (3,4);
   \draw(4,3) -- (4,4);
   \draw(5,3) -- (5,4);
   \draw(4,4) -- (5,4);
   \draw(5,4) -- (6,4);
   \draw(7,3) -- (7,4);
   \draw(6,4) -- (7,4);
   \draw(8,3) -- (8,4);
   \draw(9,3) -- (9,4);
   \draw(10,3) -- (10,4);
   \draw(11,3) -- (11,4);
   \draw(10,4) -- (11,4);
   \draw(12,3) -- (12,4);
   \draw(12,4) -- (13,4);
   \draw(14,3) -- (14,4);
   \draw(15,3) -- (15,4);
   \draw(16,4) -- (17,4);
   \draw(18,3) -- (18,4);
   \draw(17,4) -- (18,4);
   \draw(19,3) -- (19,4);
   \draw(20,4) -- (21,4);
   \draw(2,4) -- (2,5);
   \draw(3,4) -- (3,5);
   \draw(3,5) -- (4,5);
   \draw(5,4) -- (5,5);
   \draw(5,5) -- (6,5);
   \draw(7,4) -- (7,5);
   \draw(8,4) -- (8,5);
   \draw(9,4) -- (9,5);
   \draw(8,5) -- (9,5);
   \draw(10,4) -- (10,5);
   \draw(10,5) -- (11,5);
   \draw(11,5) -- (12,5);
   \draw(13,4) -- (13,5);
   \draw(14,4) -- (14,5);
   \draw(15,4) -- (15,5);
   \draw(16,4) -- (16,5);
   \draw(17,4) -- (17,5);
   \draw(18,4) -- (18,5);
   \draw(18,5) -- (19,5);
   \draw(20,5) -- (21,5);
   \draw(1,5) -- (1,6);
   \draw(0,6) -- (1,6);
   \draw(1,6) -- (2,6);
   \draw(3,5) -- (3,6);
   \draw(3,6) -- (4,6);
   \draw(5,5) -- (5,6);
   \draw(4,6) -- (5,6);
   \draw(5,6) -- (6,6);
   \draw(6,6) -- (7,6);
   \draw(8,6) -- (9,6);
   \draw(12,5) -- (12,6);
   \draw(11,6) -- (12,6);
   \draw(13,5) -- (13,6);
   \draw(15,5) -- (15,6);
   \draw(15,6) -- (16,6);
   \draw(17,5) -- (17,6);
   \draw(19,5) -- (19,6);
   \draw(19,6) -- (20,6);
   \draw(1,6) -- (1,7);
   \draw(1,7) -- (2,7);
   \draw(3,7) -- (4,7);
   \draw(4,7) -- (5,7);
   \draw(5,7) -- (6,7);
   \draw(7,7) -- (8,7);
   \draw(9,6) -- (9,7);
   \draw(8,7) -- (9,7);
   \draw(10,6) -- (10,7);
   \draw(9,7) -- (10,7);
   \draw(10,7) -- (11,7);
   \draw(11,7) -- (12,7);
   \draw(14,6) -- (14,7);
   \draw(13,7) -- (14,7);
   \draw(15,6) -- (15,7);
   \draw(17,6) -- (17,7);
   \draw(16,7) -- (17,7);
   \draw(18,6) -- (18,7);
   \draw(17,7) -- (18,7);
   \draw(18,7) -- (19,7);
   \draw(20,7) -- (21,7);
   \draw(1,7) -- (1,8);
   \draw(1,8) -- (2,8);
   \draw(3,7) -- (3,8);
   \draw(2,8) -- (3,8);
   \draw(4,7) -- (4,8);
   \draw(5,7) -- (5,8);
   \draw(8,7) -- (8,8);
   \draw(9,7) -- (9,8);
   \draw(9,8) -- (10,8);
   \draw(11,7) -- (11,8);
   \draw(11,8) -- (12,8);
   \draw(13,7) -- (13,8);
   \draw(12,8) -- (13,8);
   \draw(14,7) -- (14,8);
   \draw(14,8) -- (15,8);
   \draw(16,7) -- (16,8);
   \draw(15,8) -- (16,8);
   \draw(18,7) -- (18,8);
   \draw(17,8) -- (18,8);
   \draw(20,7) -- (20,8);
   \draw(1,8) -- (1,9);
   \draw(3,8) -- (3,9);
   \draw(2,9) -- (3,9);
   \draw(5,8) -- (5,9);
   \draw(4,9) -- (5,9);
   \draw(6,8) -- (6,9);
   \draw(7,8) -- (7,9);
   \draw(6,9) -- (7,9);
   \draw(9,8) -- (9,9);
   \draw(8,9) -- (9,9);
   \draw(9,9) -- (10,9);
   \draw(12,8) -- (12,9);
   \draw(13,8) -- (13,9);
   \draw(14,8) -- (14,9);
   \draw(14,9) -- (15,9);
   \draw(15,9) -- (16,9);
   \draw(16,9) -- (17,9);
   \draw(19,8) -- (19,9);
   \draw(18,9) -- (19,9);
   \draw(20,8) -- (20,9);
   \draw(19,9) -- (20,9);
   \draw(0,10) -- (1,10);
   \draw(2,9) -- (2,10);
   \draw(3,10) -- (4,10);
   \draw(5,9) -- (5,10);
   \draw(4,10) -- (5,10);
   \draw(5,10) -- (6,10);
   \draw(7,9) -- (7,10);
   \draw(6,10) -- (7,10);
   \draw(8,9) -- (8,10);
   \draw(8,10) -- (9,10);
   \draw(11,9) -- (11,10);
   \draw(10,10) -- (11,10);
   \draw(11,10) -- (12,10);
   \draw(12,10) -- (13,10);
   \draw(13,10) -- (14,10);
   \draw(15,9) -- (15,10);
   \draw(16,10) -- (17,10);
   \draw(17,10) -- (18,10);
   \draw(18,10) -- (19,10);
   \draw(20,9) -- (20,10);
   \draw(19,10) -- (20,10);
   \draw(0,11) -- (1,11);
   \draw(2,10) -- (2,11);
   \draw(3,10) -- (3,11);
   \draw(4,10) -- (4,11);
   \draw(5,10) -- (5,11);
   \draw(6,11) -- (7,11);
   \draw(8,10) -- (8,11);
   \draw(7,11) -- (8,11);
   \draw(9,10) -- (9,11);
   \draw(11,10) -- (11,11);
   \draw(10,11) -- (11,11);
   \draw(12,10) -- (12,11);
   \draw(14,10) -- (14,11);
   \draw(13,11) -- (14,11);
   \draw(16,10) -- (16,11);
   \draw(15,11) -- (16,11);
   \draw(16,11) -- (17,11);
   \draw(17,11) -- (18,11);
   \draw(18,11) -- (19,11);
   \draw(20,11) -- (21,11);
   \draw(1,11) -- (1,12);
   \draw(3,11) -- (3,12);
   \draw(2,12) -- (3,12);
   \draw(3,12) -- (4,12);
   \draw(5,11) -- (5,12);
   \draw(6,11) -- (6,12);
   \draw(7,11) -- (7,12);
   \draw(8,11) -- (8,12);
   \draw(10,11) -- (10,12);
   \draw(9,12) -- (10,12);
   \draw(10,12) -- (11,12);
   \draw(11,12) -- (12,12);
   \draw(12,12) -- (13,12);
   \draw(13,12) -- (14,12);
   \draw(14,12) -- (15,12);
   \draw(16,11) -- (16,12);
   \draw(15,12) -- (16,12);
   \draw(17,11) -- (17,12);
   \draw(17,12) -- (18,12);
   \draw(20,12) -- (21,12);
   \draw(1,13) -- (2,13);
   \draw(4,12) -- (4,13);
   \draw(3,13) -- (4,13);
   \draw(5,12) -- (5,13);
   \draw(5,13) -- (6,13);
   \draw(7,12) -- (7,13);
   \draw(8,12) -- (8,13);
   \draw(8,13) -- (9,13);
   \draw(11,12) -- (11,13);
   \draw(13,12) -- (13,13);
   \draw(12,13) -- (13,13);
   \draw(14,12) -- (14,13);
   \draw(15,12) -- (15,13);
   \draw(17,12) -- (17,13);
   \draw(16,13) -- (17,13);
   \draw(17,13) -- (18,13);
   \draw(19,12) -- (19,13);
   \draw(18,13) -- (19,13);
   \draw(19,13) -- (20,13);
   \draw(1,13) -- (1,14);
   \draw(0,14) -- (1,14);
   \draw(1,14) -- (2,14);
   \draw(2,14) -- (3,14);
   \draw(4,14) -- (5,14);
   \draw(5,14) -- (6,14);
   \draw(7,13) -- (7,14);
   \draw(8,13) -- (8,14);
   \draw(8,14) -- (9,14);
   \draw(10,13) -- (10,14);
   \draw(9,14) -- (10,14);
   \draw(11,13) -- (11,14);
   \draw(13,14) -- (14,14);
   \draw(14,14) -- (15,14);
   \draw(15,14) -- (16,14);
   \draw(16,14) -- (17,14);
   \draw(17,14) -- (18,14);
   \draw(20,13) -- (20,14);
   \draw(19,14) -- (20,14);
   \draw(0,15) -- (1,15);
   \draw(3,14) -- (3,15);
   \draw(2,15) -- (3,15);
   \draw(4,15) -- (5,15);
   \draw(6,14) -- (6,15);
   \draw(7,14) -- (7,15);
   \draw(8,14) -- (8,15);
   \draw(8,15) -- (9,15);
   \draw(10,14) -- (10,15);
   \draw(12,14) -- (12,15);
   \draw(12,15) -- (13,15);
   \draw(13,15) -- (14,15);
   \draw(16,14) -- (16,15);
   \draw(15,15) -- (16,15);
   \draw(16,15) -- (17,15);
   \draw(18,14) -- (18,15);
   \draw(19,14) -- (19,15);
   \draw(20,15) -- (21,15);
   \draw(1,16) -- (2,16);
   \draw(2,16) -- (3,16);
   \draw(4,15) -- (4,16);
   \draw(4,16) -- (5,16);
   \draw(6,15) -- (6,16);
   \draw(5,16) -- (6,16);
   \draw(9,15) -- (9,16);
   \draw(8,16) -- (9,16);
   \draw(10,15) -- (10,16);
   \draw(11,15) -- (11,16);
   \draw(12,15) -- (12,16);
   \draw(11,16) -- (12,16);
   \draw(12,16) -- (13,16);
   \draw(15,15) -- (15,16);
   \draw(14,16) -- (15,16);
   \draw(15,16) -- (16,16);
   \draw(18,15) -- (18,16);
   \draw(17,16) -- (18,16);
   \draw(18,16) -- (19,16);
   \draw(19,16) -- (20,16);
   \draw(2,16) -- (2,17);
   \draw(1,17) -- (2,17);
   \draw(3,16) -- (3,17);
   \draw(4,17) -- (5,17);
   \draw(6,16) -- (6,17);
   \draw(5,17) -- (6,17);
   \draw(7,16) -- (7,17);
   \draw(6,17) -- (7,17);
   \draw(8,16) -- (8,17);
   \draw(7,17) -- (8,17);
   \draw(10,16) -- (10,17);
   \draw(9,17) -- (10,17);
   \draw(11,16) -- (11,17);
   \draw(12,16) -- (12,17);
   \draw(14,16) -- (14,17);
   \draw(14,17) -- (15,17);
   \draw(16,16) -- (16,17);
   \draw(18,16) -- (18,17);
   \draw(1,17) -- (1,18);
   \draw(3,17) -- (3,18);
   \draw(2,18) -- (3,18);
   \draw(3,18) -- (4,18);
   \draw(4,18) -- (5,18);
   \draw(6,17) -- (6,18);
   \draw(5,18) -- (6,18);
   \draw(8,17) -- (8,18);
   \draw(10,17) -- (10,18);
   \draw(9,18) -- (10,18);
   \draw(11,17) -- (11,18);
   \draw(12,17) -- (12,18);
   \draw(13,17) -- (13,18);
   \draw(13,18) -- (14,18);
   \draw(15,17) -- (15,18);
   \draw(14,18) -- (15,18);
   \draw(15,18) -- (16,18);
   \draw(17,17) -- (17,18);
   \draw(16,18) -- (17,18);
   \draw(18,17) -- (18,18);
   \draw(19,17) -- (19,18);
   \draw(18,18) -- (19,18);
   \draw(20,17) -- (20,18);
   \draw(20,18) -- (21,18);
   \draw(0,19) -- (1,19);
   \draw(2,19) -- (3,19);
   \draw(4,18) -- (4,19);
   \draw(4,19) -- (5,19);
   \draw(7,18) -- (7,19);
   \draw(6,19) -- (7,19);
   \draw(8,19) -- (9,19);
   \draw(10,18) -- (10,19);
   \draw(11,18) -- (11,19);
   \draw(10,19) -- (11,19);
   \draw(12,18) -- (12,19);
   \draw(12,19) -- (13,19);
   \draw(13,19) -- (14,19);
   \draw(15,18) -- (15,19);
   \draw(14,19) -- (15,19);
   \draw(16,19) -- (17,19);
   \draw(17,19) -- (18,19);
   \draw(18,19) -- (19,19);
   \draw(19,19) -- (20,19);
   \draw(1,19) -- (1,20);
   \draw(2,19) -- (2,20);
   \draw(3,19) -- (3,20);
   \draw(3,20) -- (4,20);
   \draw(6,19) -- (6,20);
   \draw(6,20) -- (7,20);
   \draw(8,19) -- (8,20);
   \draw(7,20) -- (8,20);
   \draw(8,20) -- (9,20);
   \draw(12,19) -- (12,20);
   \draw(11,20) -- (12,20);
   \draw(12,20) -- (13,20);
   \draw(15,19) -- (15,20);
   \draw(14,20) -- (15,20);
   \draw(16,19) -- (16,20);
   \draw(16,20) -- (17,20);
   \draw(18,20) -- (19,20);
   \draw(19,20) -- (20,20);
   \draw(20,20) -- (21,20);
   \draw(3,20) -- (3,21);
   \draw(5,20) -- (5,21);
   \draw(6,20) -- (6,21);
   \draw(10,20) -- (10,21);
   \draw(14,20) -- (14,21);
   \draw(16,20) -- (16,21);
 \end{tikzpicture}
 #+END_SRC




*** An Even Larger Example 

 #+BEGIN_SRC sh :results verbatim :wrap "SRC latex :imagemagick yes :iminoptions -density 600 :imoutoptions -geometry 400 :results raw :yexports results :fit yes :noweb yes :file images/maze3.png  :headers '(\"\\\\usepackage{tikz}\")" :exports both
 mcs demo/mazegenerator.cs src/unionfind.cs
 mono demo/mazegenerator.exe 54 54 
 #+END_SRC

 #+RESULTS:
 #+BEGIN_SRC latex :imagemagick yes :iminoptions -density 600 :imoutoptions -geometry 400 :results raw :yexports results :fit yes :noweb yes :file images/maze2.png  :headers '("\\usepackage{tikz}")
 \begin{tikzpicture}[>=latex]
   \draw[thick](0,0) -- (21,0);
   \draw[thick](0,21) -- (21,21);
   \draw[thick](0,0) -- (0,20);
   \draw[thick](21,1) -- (21,21);
   \draw(3,0) -- (3,1);
   \draw(2,1) -- (3,1);
   \draw(6,0) -- (6,1);
   \draw(7,0) -- (7,1);
   \draw(8,0) -- (8,1);
   \draw(10,0) -- (10,1);
   \draw(9,1) -- (10,1);
   \draw(10,1) -- (11,1);
   \draw(11,1) -- (12,1);
   \draw(12,1) -- (13,1);
   \draw(13,1) -- (14,1);
   \draw(14,1) -- (15,1);
   \draw(16,0) -- (16,1);
   \draw(17,0) -- (17,1);
   \draw(18,0) -- (18,1);
   \draw(20,0) -- (20,1);
   \draw(19,1) -- (20,1);
   \draw(1,1) -- (1,2);
   \draw(0,2) -- (1,2);
   \draw(1,2) -- (2,2);
   \draw(2,2) -- (3,2);
   \draw(4,1) -- (4,2);
   \draw(5,1) -- (5,2);
   \draw(4,2) -- (5,2);
   \draw(6,1) -- (6,2);
   \draw(5,2) -- (6,2);
   \draw(9,1) -- (9,2);
   \draw(8,2) -- (9,2);
   \draw(10,1) -- (10,2);
   \draw(10,2) -- (11,2);
   \draw(14,1) -- (14,2);
   \draw(13,2) -- (14,2);
   \draw(15,2) -- (16,2);
   \draw(17,1) -- (17,2);
   \draw(19,1) -- (19,2);
   \draw(19,2) -- (20,2);
   \draw(0,3) -- (1,3);
   \draw(7,2) -- (7,3);
   \draw(6,3) -- (7,3);
   \draw(8,2) -- (8,3);
   \draw(7,3) -- (8,3);
   \draw(11,2) -- (11,3);
   \draw(12,2) -- (12,3);
   \draw(13,2) -- (13,3);
   \draw(12,3) -- (13,3);
   \draw(13,3) -- (14,3);
   \draw(14,3) -- (15,3);
   \draw(16,2) -- (16,3);
   \draw(16,3) -- (17,3);
   \draw(18,2) -- (18,3);
   \draw(17,3) -- (18,3);
   \draw(19,2) -- (19,3);
   \draw(20,3) -- (21,3);
   \draw(1,3) -- (1,4);
   \draw(2,3) -- (2,4);
   \draw(1,4) -- (2,4);
   \draw(3,3) -- (3,4);
   \draw(4,3) -- (4,4);
   \draw(5,3) -- (5,4);
   \draw(4,4) -- (5,4);
   \draw(5,4) -- (6,4);
   \draw(7,3) -- (7,4);
   \draw(6,4) -- (7,4);
   \draw(8,3) -- (8,4);
   \draw(9,3) -- (9,4);
   \draw(10,3) -- (10,4);
   \draw(11,3) -- (11,4);
   \draw(10,4) -- (11,4);
   \draw(12,3) -- (12,4);
   \draw(12,4) -- (13,4);
   \draw(14,3) -- (14,4);
   \draw(15,3) -- (15,4);
   \draw(16,4) -- (17,4);
   \draw(18,3) -- (18,4);
   \draw(17,4) -- (18,4);
   \draw(19,3) -- (19,4);
   \draw(20,4) -- (21,4);
   \draw(2,4) -- (2,5);
   \draw(3,4) -- (3,5);
   \draw(3,5) -- (4,5);
   \draw(5,4) -- (5,5);
   \draw(5,5) -- (6,5);
   \draw(7,4) -- (7,5);
   \draw(8,4) -- (8,5);
   \draw(9,4) -- (9,5);
   \draw(8,5) -- (9,5);
   \draw(10,4) -- (10,5);
   \draw(10,5) -- (11,5);
   \draw(11,5) -- (12,5);
   \draw(13,4) -- (13,5);
   \draw(14,4) -- (14,5);
   \draw(15,4) -- (15,5);
   \draw(16,4) -- (16,5);
   \draw(17,4) -- (17,5);
   \draw(18,4) -- (18,5);
   \draw(18,5) -- (19,5);
   \draw(20,5) -- (21,5);
   \draw(1,5) -- (1,6);
   \draw(0,6) -- (1,6);
   \draw(1,6) -- (2,6);
   \draw(3,5) -- (3,6);
   \draw(3,6) -- (4,6);
   \draw(5,5) -- (5,6);
   \draw(4,6) -- (5,6);
   \draw(5,6) -- (6,6);
   \draw(6,6) -- (7,6);
   \draw(8,6) -- (9,6);
   \draw(12,5) -- (12,6);
   \draw(11,6) -- (12,6);
   \draw(13,5) -- (13,6);
   \draw(15,5) -- (15,6);
   \draw(15,6) -- (16,6);
   \draw(17,5) -- (17,6);
   \draw(19,5) -- (19,6);
   \draw(19,6) -- (20,6);
   \draw(1,6) -- (1,7);
   \draw(1,7) -- (2,7);
   \draw(3,7) -- (4,7);
   \draw(4,7) -- (5,7);
   \draw(5,7) -- (6,7);
   \draw(7,7) -- (8,7);
   \draw(9,6) -- (9,7);
   \draw(8,7) -- (9,7);
   \draw(10,6) -- (10,7);
   \draw(9,7) -- (10,7);
   \draw(10,7) -- (11,7);
   \draw(11,7) -- (12,7);
   \draw(14,6) -- (14,7);
   \draw(13,7) -- (14,7);
   \draw(15,6) -- (15,7);
   \draw(17,6) -- (17,7);
   \draw(16,7) -- (17,7);
   \draw(18,6) -- (18,7);
   \draw(17,7) -- (18,7);
   \draw(18,7) -- (19,7);
   \draw(20,7) -- (21,7);
   \draw(1,7) -- (1,8);
   \draw(1,8) -- (2,8);
   \draw(3,7) -- (3,8);
   \draw(2,8) -- (3,8);
   \draw(4,7) -- (4,8);
   \draw(5,7) -- (5,8);
   \draw(8,7) -- (8,8);
   \draw(9,7) -- (9,8);
   \draw(9,8) -- (10,8);
   \draw(11,7) -- (11,8);
   \draw(11,8) -- (12,8);
   \draw(13,7) -- (13,8);
   \draw(12,8) -- (13,8);
   \draw(14,7) -- (14,8);
   \draw(14,8) -- (15,8);
   \draw(16,7) -- (16,8);
   \draw(15,8) -- (16,8);
   \draw(18,7) -- (18,8);
   \draw(17,8) -- (18,8);
   \draw(20,7) -- (20,8);
   \draw(1,8) -- (1,9);
   \draw(3,8) -- (3,9);
   \draw(2,9) -- (3,9);
   \draw(5,8) -- (5,9);
   \draw(4,9) -- (5,9);
   \draw(6,8) -- (6,9);
   \draw(7,8) -- (7,9);
   \draw(6,9) -- (7,9);
   \draw(9,8) -- (9,9);
   \draw(8,9) -- (9,9);
   \draw(9,9) -- (10,9);
   \draw(12,8) -- (12,9);
   \draw(13,8) -- (13,9);
   \draw(14,8) -- (14,9);
   \draw(14,9) -- (15,9);
   \draw(15,9) -- (16,9);
   \draw(16,9) -- (17,9);
   \draw(19,8) -- (19,9);
   \draw(18,9) -- (19,9);
   \draw(20,8) -- (20,9);
   \draw(19,9) -- (20,9);
   \draw(0,10) -- (1,10);
   \draw(2,9) -- (2,10);
   \draw(3,10) -- (4,10);
   \draw(5,9) -- (5,10);
   \draw(4,10) -- (5,10);
   \draw(5,10) -- (6,10);
   \draw(7,9) -- (7,10);
   \draw(6,10) -- (7,10);
   \draw(8,9) -- (8,10);
   \draw(8,10) -- (9,10);
   \draw(11,9) -- (11,10);
   \draw(10,10) -- (11,10);
   \draw(11,10) -- (12,10);
   \draw(12,10) -- (13,10);
   \draw(13,10) -- (14,10);
   \draw(15,9) -- (15,10);
   \draw(16,10) -- (17,10);
   \draw(17,10) -- (18,10);
   \draw(18,10) -- (19,10);
   \draw(20,9) -- (20,10);
   \draw(19,10) -- (20,10);
   \draw(0,11) -- (1,11);
   \draw(2,10) -- (2,11);
   \draw(3,10) -- (3,11);
   \draw(4,10) -- (4,11);
   \draw(5,10) -- (5,11);
   \draw(6,11) -- (7,11);
   \draw(8,10) -- (8,11);
   \draw(7,11) -- (8,11);
   \draw(9,10) -- (9,11);
   \draw(11,10) -- (11,11);
   \draw(10,11) -- (11,11);
   \draw(12,10) -- (12,11);
   \draw(14,10) -- (14,11);
   \draw(13,11) -- (14,11);
   \draw(16,10) -- (16,11);
   \draw(15,11) -- (16,11);
   \draw(16,11) -- (17,11);
   \draw(17,11) -- (18,11);
   \draw(18,11) -- (19,11);
   \draw(20,11) -- (21,11);
   \draw(1,11) -- (1,12);
   \draw(3,11) -- (3,12);
   \draw(2,12) -- (3,12);
   \draw(3,12) -- (4,12);
   \draw(5,11) -- (5,12);
   \draw(6,11) -- (6,12);
   \draw(7,11) -- (7,12);
   \draw(8,11) -- (8,12);
   \draw(10,11) -- (10,12);
   \draw(9,12) -- (10,12);
   \draw(10,12) -- (11,12);
   \draw(11,12) -- (12,12);
   \draw(12,12) -- (13,12);
   \draw(13,12) -- (14,12);
   \draw(14,12) -- (15,12);
   \draw(16,11) -- (16,12);
   \draw(15,12) -- (16,12);
   \draw(17,11) -- (17,12);
   \draw(17,12) -- (18,12);
   \draw(20,12) -- (21,12);
   \draw(1,13) -- (2,13);
   \draw(4,12) -- (4,13);
   \draw(3,13) -- (4,13);
   \draw(5,12) -- (5,13);
   \draw(5,13) -- (6,13);
   \draw(7,12) -- (7,13);
   \draw(8,12) -- (8,13);
   \draw(8,13) -- (9,13);
   \draw(11,12) -- (11,13);
   \draw(13,12) -- (13,13);
   \draw(12,13) -- (13,13);
   \draw(14,12) -- (14,13);
   \draw(15,12) -- (15,13);
   \draw(17,12) -- (17,13);
   \draw(16,13) -- (17,13);
   \draw(17,13) -- (18,13);
   \draw(19,12) -- (19,13);
   \draw(18,13) -- (19,13);
   \draw(19,13) -- (20,13);
   \draw(1,13) -- (1,14);
   \draw(0,14) -- (1,14);
   \draw(1,14) -- (2,14);
   \draw(2,14) -- (3,14);
   \draw(4,14) -- (5,14);
   \draw(5,14) -- (6,14);
   \draw(7,13) -- (7,14);
   \draw(8,13) -- (8,14);
   \draw(8,14) -- (9,14);
   \draw(10,13) -- (10,14);
   \draw(9,14) -- (10,14);
   \draw(11,13) -- (11,14);
   \draw(13,14) -- (14,14);
   \draw(14,14) -- (15,14);
   \draw(15,14) -- (16,14);
   \draw(16,14) -- (17,14);
   \draw(17,14) -- (18,14);
   \draw(20,13) -- (20,14);
   \draw(19,14) -- (20,14);
   \draw(0,15) -- (1,15);
   \draw(3,14) -- (3,15);
   \draw(2,15) -- (3,15);
   \draw(4,15) -- (5,15);
   \draw(6,14) -- (6,15);
   \draw(7,14) -- (7,15);
   \draw(8,14) -- (8,15);
   \draw(8,15) -- (9,15);
   \draw(10,14) -- (10,15);
   \draw(12,14) -- (12,15);
   \draw(12,15) -- (13,15);
   \draw(13,15) -- (14,15);
   \draw(16,14) -- (16,15);
   \draw(15,15) -- (16,15);
   \draw(16,15) -- (17,15);
   \draw(18,14) -- (18,15);
   \draw(19,14) -- (19,15);
   \draw(20,15) -- (21,15);
   \draw(1,16) -- (2,16);
   \draw(2,16) -- (3,16);
   \draw(4,15) -- (4,16);
   \draw(4,16) -- (5,16);
   \draw(6,15) -- (6,16);
   \draw(5,16) -- (6,16);
   \draw(9,15) -- (9,16);
   \draw(8,16) -- (9,16);
   \draw(10,15) -- (10,16);
   \draw(11,15) -- (11,16);
   \draw(12,15) -- (12,16);
   \draw(11,16) -- (12,16);
   \draw(12,16) -- (13,16);
   \draw(15,15) -- (15,16);
   \draw(14,16) -- (15,16);
   \draw(15,16) -- (16,16);
   \draw(18,15) -- (18,16);
   \draw(17,16) -- (18,16);
   \draw(18,16) -- (19,16);
   \draw(19,16) -- (20,16);
   \draw(2,16) -- (2,17);
   \draw(1,17) -- (2,17);
   \draw(3,16) -- (3,17);
   \draw(4,17) -- (5,17);
   \draw(6,16) -- (6,17);
   \draw(5,17) -- (6,17);
   \draw(7,16) -- (7,17);
   \draw(6,17) -- (7,17);
   \draw(8,16) -- (8,17);
   \draw(7,17) -- (8,17);
   \draw(10,16) -- (10,17);
   \draw(9,17) -- (10,17);
   \draw(11,16) -- (11,17);
   \draw(12,16) -- (12,17);
   \draw(14,16) -- (14,17);
   \draw(14,17) -- (15,17);
   \draw(16,16) -- (16,17);
   \draw(18,16) -- (18,17);
   \draw(1,17) -- (1,18);
   \draw(3,17) -- (3,18);
   \draw(2,18) -- (3,18);
   \draw(3,18) -- (4,18);
   \draw(4,18) -- (5,18);
   \draw(6,17) -- (6,18);
   \draw(5,18) -- (6,18);
   \draw(8,17) -- (8,18);
   \draw(10,17) -- (10,18);
   \draw(9,18) -- (10,18);
   \draw(11,17) -- (11,18);
   \draw(12,17) -- (12,18);
   \draw(13,17) -- (13,18);
   \draw(13,18) -- (14,18);
   \draw(15,17) -- (15,18);
   \draw(14,18) -- (15,18);
   \draw(15,18) -- (16,18);
   \draw(17,17) -- (17,18);
   \draw(16,18) -- (17,18);
   \draw(18,17) -- (18,18);
   \draw(19,17) -- (19,18);
   \draw(18,18) -- (19,18);
   \draw(20,17) -- (20,18);
   \draw(20,18) -- (21,18);
   \draw(0,19) -- (1,19);
   \draw(2,19) -- (3,19);
   \draw(4,18) -- (4,19);
   \draw(4,19) -- (5,19);
   \draw(7,18) -- (7,19);
   \draw(6,19) -- (7,19);
   \draw(8,19) -- (9,19);
   \draw(10,18) -- (10,19);
   \draw(11,18) -- (11,19);
   \draw(10,19) -- (11,19);
   \draw(12,18) -- (12,19);
   \draw(12,19) -- (13,19);
   \draw(13,19) -- (14,19);
   \draw(15,18) -- (15,19);
   \draw(14,19) -- (15,19);
   \draw(16,19) -- (17,19);
   \draw(17,19) -- (18,19);
   \draw(18,19) -- (19,19);
   \draw(19,19) -- (20,19);
   \draw(1,19) -- (1,20);
   \draw(2,19) -- (2,20);
   \draw(3,19) -- (3,20);
   \draw(3,20) -- (4,20);
   \draw(6,19) -- (6,20);
   \draw(6,20) -- (7,20);
   \draw(8,19) -- (8,20);
   \draw(7,20) -- (8,20);
   \draw(8,20) -- (9,20);
   \draw(12,19) -- (12,20);
   \draw(11,20) -- (12,20);
   \draw(12,20) -- (13,20);
   \draw(15,19) -- (15,20);
   \draw(14,20) -- (15,20);
   \draw(16,19) -- (16,20);
   \draw(16,20) -- (17,20);
   \draw(18,20) -- (19,20);
   \draw(19,20) -- (20,20);
   \draw(20,20) -- (21,20);
   \draw(3,20) -- (3,21);
   \draw(5,20) -- (5,21);
   \draw(6,20) -- (6,21);
   \draw(10,20) -- (10,21);
   \draw(14,20) -- (14,21);
   \draw(16,20) -- (16,21);
 \end{tikzpicture}
 #+END_SRC
